<!-- app/views/home/index.html.erb -->
<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link rel="stylesheet" href="/styles/styles.css">
  <script defer src="/styles/theme.js"></script>
  <title>Fases da Lua</title>

  <style>
    :root{
      --rail-w: 300px;
      --bg-grad: radial-gradient(1200px 600px at 70% 0%, rgba(84,118,171,.08), transparent);
    }

    /* PALETAS DO TEMA */
    :root[data-theme="dark"]{
      --page-bg:#0b1117;
      --text:#e7eef7;
      --muted:#a9b4c2;
      --border:rgba(255,255,255,.08);
      --rail-bg:#1e2430;
      --rail-title-bg:#151a22;
      --badge-bg:#153042;
      --badge-border:rgba(255,255,255,.18);
      --card-bg:#111823;
      --list-bg:#0f151f;
      --hover-bg:rgba(255,255,255,.06);
      --icon:#9bd2f8;
    }

    :root[data-theme="light"]{
      --page-bg:#f7fafc;
      --text:#0b1622;
      --muted:#4b5563;
      --border:rgba(0,0,0,.1);
      --rail-bg:#ffffff;
      --rail-title-bg:#f3f6f9;
      --badge-bg:#e8f1ff;
      --badge-border:rgba(0,0,0,.12);
      --card-bg:#ffffff;
      --list-bg:#f7fafc;
      --hover-bg:rgba(0,0,0,.04);
      --icon:#2563eb;
    }

    /* layout base */
    html,body{height:100%}
    body{background:var(--page-bg);color:var(--text)}
    .page{
      min-height:100dvh;
      background-image:var(--bg-grad);
    }
    .layout{
      display:grid;
      grid-template-columns: 1fr;
      gap:24px;
      width:min(1200px, 100%);
      margin:0 auto;
      padding:20px 16px 40px;
    }
    @media (min-width: 1024px){
      .layout{
        grid-template-columns: var(--rail-w) 1fr;
        gap:24px;
        padding:32px 24px 56px;
      }
    }

    /* barra lateral fixa no desktop, faixa no mobile */
    .rail{
      background:var(--rail-bg);
      border:1px solid var(--border);
      border-radius:14px;
      padding:14px;
      position:relative;
    }
    @media (min-width:1024px){
      .rail{
        position:sticky;
        top:24px;
        height:calc(100dvh - 48px);
        overflow:auto;
      }
    }

    .ri-title{
      display:flex;align-items:center;gap:10px;
      background:var(--rail-title-bg);border-radius:10px;padding:12px 12px;margin-bottom:12px
    }
    .ri-badge{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:8px;background:var(--rail-title-bg)}
    .ri-text{font-weight:700}

    .rail-sep{height:1px;background:var(--border);margin:10px 0}
    .rail-item{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px}
    .rail-item:hover{background:var(--hover-bg)}
    .ri-col{display:flex;flex-direction:column;line-height:1.1}
    .ri-value{font-size:18px;font-weight:700}
    .ri-sub{font-size:12px;color:var(--muted)}

    /* cabeÃ§alho principal */
    .header{
      display:flex;justify-content:space-between;align-items:center;margin-bottom:12px
    }
    .title{font-size:clamp(22px, 2.4vw, 36px);line-height:1.2}

    /* botÃ£o de tema segue seu CSS global .toggle */
    .toggle .fas{margin-right:.4rem}

    /* cards */
    .grid-2{
      display:grid;gap:20px;
      grid-template-columns: 1fr;
    }
    @media (min-width:900px){
      .grid-2{grid-template-columns: 1fr 1fr}
    }
    .card{
      background:var(--card-bg);border:1px solid var(--border);
      border-radius:14px;overflow:hidden
    }
    .card-header{padding:14px 18px;border-bottom:1px solid var(--border)}
    .card-title{font-weight:700}
    .card-body{padding:18px}
    .center{display:flex;flex-direction:column;align-items:center;gap:14px}
    .big-icon{font-size:48px;color:var(--icon)}
    .badge{background:var(--badge-bg);border:1px solid var(--badge-border);padding:8px 14px;border-radius:999px;font-weight:700}

    /* lista de prÃ³ximas fases */
    .moon-phases{display:flex;flex-direction:column;gap:10px}
    .moon-phase{
      display:grid;
      grid-template-columns: 28px 1fr auto;
      align-items:center;
      gap:12px;
      background:var(--list-bg);border:1px solid var(--border);
      padding:10px 12px;border-radius:10px
    }
    .mp-icon{display:flex;justify-content:center;opacity:.85;color:var(--icon)}
    .date{font-variant-numeric:tabular-nums;color:var(--muted)}
    .phase{font-weight:600}
    .main{display:flex;flex-direction:column;gap:22px}
  </style>
</head>
<body>
  <div class="page">
    <div class="layout">
      <aside class="rail">
        <div class="ri-title">
          <span class="ri-badge"><i class="fas fa-map-marker-alt"></i></span>
          <span class="ri-text"><%= @city_label %></span>
        </div>

        <div class="rail-item">
          <span class="ri-badge">ðŸŒž</span>
          <div class="ri-col">
            <span class="ri-value"><%= @today&.dig(:max) || "â€”" %>Â°</span>
            <span class="ri-sub">mÃ¡x</span>
          </div>
        </div>

        <div class="rail-item">
          <span class="ri-badge">ðŸŒ™</span>
          <div class="ri-col">
            <span class="ri-value"><%= @today&.dig(:min) || "â€”" %>Â°</span>
            <span class="ri-sub">mÃ­n</span>
          </div>
        </div>

        <div class="rail-item">
          <span class="ri-badge">ðŸŒ—</span>
          <div class="ri-col">
            <span class="ri-value small"><%= @current_phase[:phase] %></span>
            <span class="ri-sub">lua</span>
          </div>
        </div>
      </aside>

      <main class="main">
        <header class="header">
          <h1 class="title">Fases da Lua</h1>
          <button id="themeToggle" class="toggle" aria-label="Alternar tema">
            <i class="fas fa-adjust"></i><span class="toggle-text">Tema</span>
          </button>
        </header>

        <section class="grid-2">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Fase Atual</h2>
            </div>
            <div class="card-body center">
              <i class="fas fa-moon big-icon"></i>
              <span class="badge"><%= @current_phase[:phase] %></span>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2 class="card-title">EstaÃ§Ã£o</h2>
            </div>
            <div class="card-body center">
              <i class="fas fa-sun big-icon"></i>
              <div class="season-line">
                <span class="badge"><%= @current_season[:name] %></span>
              </div>
              <div style="display:flex;gap:10px;color:var(--muted)">
                <span><%= @current_season[:start_date]&.strftime('%d/%m/%Y') %></span>
                <span>â€¢</span>
                <span><%= @current_season[:end_date]&.strftime('%d/%m/%Y') %></span>
              </div>
            </div>
          </div>
        </section>

        <section class="card">
          <div class="card-header">
            <h2 class="card-title">PrÃ³ximas Fases</h2>
          </div>
          <div class="card-body">
            <div class="moon-phases">
              <% @next_phases.each do |phase| %>
                <div class="moon-phase">
                  <div class="mp-icon"><i class="fas fa-moon"></i></div>
                  <div class="date"><%= phase[:date].strftime('%d/%m/%Y') %></div>
                  <div class="phase"><%= phase[:phase] %></div>
                </div>
              <% end %>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>
</body>
</html>
